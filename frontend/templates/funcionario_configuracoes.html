<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configurações - Banco Malvader</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #000B3A;
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body class="text-white">
  <header class="bg-white py-4 px-6 mb-8 shadow-lg">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-4">
        <a href="painel_funcionario.html" class="text-gray-600 hover:text-gray-800">
          <i class="fas fa-arrow-left"></i> Voltar ao Painel
        </a>
        <img src="../assets/images/logo.png" alt="Logo malvader" class="h-12">
      </div>
      <div class="flex items-center space-x-6">
        <div class="text-right">
          <p class="text-sm text-gray-600">Funcionário</p>
          <p class="font-semibold text-gray-900" id="nomeFuncionario">Carregando...</p>
          <p class="text-xs text-gray-500" id="cargoFuncionario">Cargo...</p>
        </div>
        <a href="login.html" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
          <i class="fas fa-sign-out-alt mr-2"></i>Sair
        </a>
      </div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-6">
    <div class="mb-8">
      <h2 class="text-2xl font-bold mb-2">Configurações do Sistema</h2>
      <p class="text-sm opacity-70">Gerencie as configurações operacionais do banco.</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Configurações de Conta -->
      <div class="glass-effect rounded-xl p-6">
        <h3 class="text-xl font-semibold mb-4">Configurações de Conta</h3>
        
        <form id="configContaForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" for="saldoMinimo">
              Saldo Mínimo (R$)
            </label>
            <input type="number" id="saldoMinimo" step="0.01" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="taxaManutencao">
              Taxa de Manutenção Mensal (%)
            </label>
            <input type="number" id="taxaManutencao" step="0.01" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="limiteSaque">
              Limite de Saque Diário (R$)
            </label>
            <input type="number" id="limiteSaque" step="0.01" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
            Salvar Configurações de Conta
          </button>
        </form>
      </div>

      <!-- Configurações de Inadimplência -->
      <div class="glass-effect rounded-xl p-6">
        <h3 class="text-xl font-semibold mb-4">Configurações de Inadimplência</h3>
        
        <form id="configInadimplenciaForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" for="diasInadimplencia">
              Dias para Inadimplência
            </label>
            <input type="number" id="diasInadimplencia" min="1" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="taxaJuros">
              Taxa de Juros por Atraso (% ao mês)
            </label>
            <input type="number" id="taxaJuros" step="0.01" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="multa">
              Multa por Atraso (%)
            </label>
            <input type="number" id="multa" step="0.01" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
            Salvar Configurações de Inadimplência
          </button>
        </form>
      </div>

      <!-- Configurações de Notificação -->
      <div class="glass-effect rounded-xl p-6">
        <h3 class="text-xl font-semibold mb-4">Configurações de Notificação</h3>
        
        <form id="configNotificacaoForm" class="space-y-4">
          <div class="flex items-center mb-4">
            <input type="checkbox" id="notifSaque" class="mr-2">
            <label for="notifSaque" class="text-sm">
              Notificar saques acima do limite
            </label>
          </div>

          <div class="flex items-center mb-4">
            <input type="checkbox" id="notifInadimplencia" class="mr-2">
            <label for="notifInadimplencia" class="text-sm">
              Notificar novos inadimplentes
            </label>
          </div>

          <div class="flex items-center mb-4">
            <input type="checkbox" id="notifTransSuspeita" class="mr-2">
            <label for="notifTransSuspeita" class="text-sm">
              Notificar transações suspeitas
            </label>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="emailNotificacao">
              Email para Notificações
            </label>
            <input type="email" id="emailNotificacao" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
            Salvar Configurações de Notificação
          </button>
        </form>
      </div>

      <!-- Configurações de Segurança -->
      <div class="glass-effect rounded-xl p-6">
        <h3 class="text-xl font-semibold mb-4">Configurações de Segurança</h3>
        
        <form id="configSegurancaForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" for="tempoSessao">
              Tempo de Sessão (minutos)
            </label>
            <input type="number" id="tempoSessao" min="5" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="tentativasLogin">
              Tentativas de Login Permitidas
            </label>
            <input type="number" id="tentativasLogin" min="1" 
              class="w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 focus:border-blue-500 focus:outline-none">
          </div>

          <div class="flex items-center mb-4">
            <input type="checkbox" id="autenticacaoDupla" class="mr-2">
            <label for="autenticacaoDupla" class="text-sm">
              Exigir autenticação em duas etapas para todos os funcionários
            </label>
          </div>

          <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
            Salvar Configurações de Segurança
          </button>
        </form>
      </div>
    </div>
  </main>

  <script>
    // Carregar dados do funcionário logado
    window.addEventListener('load', function() {
      const usuario = JSON.parse(localStorage.getItem('usuario'));
      if (usuario) {
        document.getElementById('nomeFuncionario').textContent = usuario.nome;
        document.getElementById('cargoFuncionario').textContent = usuario.cargo || 'Funcionário';
        carregarConfiguracoes();
      } else {
        window.location.href = 'login.html';
      }
    });

    // Carregar configurações atuais
    async function carregarConfiguracoes() {
      try {
        const response = await fetch('http://127.0.0.1:5000/configuracoes');
        const data = await response.json();

        if (data.success) {
          // Configurações de Conta
          document.getElementById('saldoMinimo').value = data.config.saldo_minimo;
          document.getElementById('taxaManutencao').value = data.config.taxa_manutencao;
          document.getElementById('limiteSaque').value = data.config.limite_saque;

          // Configurações de Inadimplência
          document.getElementById('diasInadimplencia').value = data.config.dias_inadimplencia;
          document.getElementById('taxaJuros').value = data.config.taxa_juros;
          document.getElementById('multa').value = data.config.multa;

          // Configurações de Notificação
          document.getElementById('notifSaque').checked = data.config.notif_saque;
          document.getElementById('notifInadimplencia').checked = data.config.notif_inadimplencia;
          document.getElementById('notifTransSuspeita').checked = data.config.notif_trans_suspeita;
          document.getElementById('emailNotificacao').value = data.config.email_notificacao;

          // Configurações de Segurança
          document.getElementById('tempoSessao').value = data.config.tempo_sessao;
          document.getElementById('tentativasLogin').value = data.config.tentativas_login;
          document.getElementById('autenticacaoDupla').checked = data.config.autenticacao_dupla;
        }
      } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao carregar configurações');
      }
    }

    // Salvar configurações de conta
    document.getElementById('configContaForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const config = {
        saldo_minimo: parseFloat(document.getElementById('saldoMinimo').value),
        taxa_manutencao: parseFloat(document.getElementById('taxaManutencao').value),
        limite_saque: parseFloat(document.getElementById('limiteSaque').value)
      };

      await salvarConfiguracoes('conta', config);
    });

    // Salvar configurações de inadimplência
    document.getElementById('configInadimplenciaForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const config = {
        dias_inadimplencia: parseInt(document.getElementById('diasInadimplencia').value),
        taxa_juros: parseFloat(document.getElementById('taxaJuros').value),
        multa: parseFloat(document.getElementById('multa').value)
      };

      await salvarConfiguracoes('inadimplencia', config);
    });

    // Salvar configurações de notificação
    document.getElementById('configNotificacaoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const config = {
        notif_saque: document.getElementById('notifSaque').checked,
        notif_inadimplencia: document.getElementById('notifInadimplencia').checked,
        notif_trans_suspeita: document.getElementById('notifTransSuspeita').checked,
        email_notificacao: document.getElementById('emailNotificacao').value
      };

      await salvarConfiguracoes('notificacao', config);
    });

    // Salvar configurações de segurança
    document.getElementById('configSegurancaForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const config = {
        tempo_sessao: parseInt(document.getElementById('tempoSessao').value),
        tentativas_login: parseInt(document.getElementById('tentativasLogin').value),
        autenticacao_dupla: document.getElementById('autenticacaoDupla').checked
      };

      await salvarConfiguracoes('seguranca', config);
    });

    // Função genérica para salvar configurações
    async function salvarConfiguracoes(tipo, config) {
      try {
        const response = await fetch(`http://127.0.0.1:5000/configuracoes/${tipo}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(config)
        });

        const data = await response.json();

        if (data.success) {
          alert('Configurações salvas com sucesso!');
        } else {
          alert(data.message || 'Erro ao salvar configurações');
        }
      } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao salvar configurações');
      }
    }
  </script>
</body>
</html>
